<html>

<head>
  <title>Message Brian</title>

  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="icon" href="http://brianwtracey.com.s3-website-us-east-1.amazonaws.com/favicon.png" type="image/icon">

</head>

<body>

  <div class="content">
    <h2>Send Brian a message on his Tidbyt.</h2>
    <form method="post" action="https://api.brianwtracey.com/message">

      <p>
        <label>Message Text
          <textarea name="MESSAGE_TEXT" maxlength=100>Type your message here.</textarea>
        </label>
      </p>

      <p>
        <label>Font Color
          <input type="color" id="HEX_COLOR" name="HEX_COLOR" value="#ad97ef">
        </label>
      </p>

      <!-- <p> -->
      <!--   <label>Scroll Delay (ms) -->
      <!--     <input type="number" id="SCROLL_SPEED" name="SCROLL_SPEED" min="0" max="500" step="50" value="0"> -->
      <!--   </label> -->
      <!-- </p> -->

      <p>
        <label>Scroll Speed</label>
        <input id="SCROLL_SPEED" name="SCROLL_SPEED" type="range" min="0" value="250" max="500" step="1" list="ticks">
        <datalist id="ticks">
          <option value="0">fast</option>
          <option value="125"></option>
          <option value="250"></option>
          <option value="375"></option>
          <option value="500">slow</option>
        </datalist>
      </p>

      <p>
        <label>Font
          <select name="FONT" id="FONT" maxlength=100>
            <option value="6x13" selected="selected">6x13</option>
            <option value="tb-8">tb-8</option>
            <option value="Dina_r400-6">Dina_r400-6</option>
            <option value="5x8">5x8</option>
            <option value="10x20">10x20</option>
            <option value="tom-thumb">tom-thumb</option>
            <option value="CG-pixel-3x5-mono">CG-pixel-3x5-mono</option>
            <option value="CG-pixel-4x5-mono">CG-pixel-4x5-mono</option>
          </select>
        </label>
        <a href="https://github.com/tidbyt/pixlet/blob/main/docs/fonts.md">Font Examples</a>
      </p>

      <p>
        <button>Send Message</button>
      </p>

    </form>
  </div>
  <div id="stop_button">
    <h2>Other Tidbyt actions!</h2>
    <p>
      <button onclick="sendStop()" type="button">Tell Brian to stop talking!</button>
    </p>
  </div>
  <div id="response_messages">
  </div>

  <script>
    //sends the stop api request and displays the returned text
    const sendStop = async () => {
      const response = await fetch("https://api.brianwtracey.com/stop");
      const myJson = await response.json();
      const responseDiv = document.getElementById("response_messages");
      const newContent = document.createTextNode(myJson);
      responseDiv.appendChild(newContent);

      console.log("json response:");
      console.log(myJson);
    }

    // make the slider snap to the ticks
    const speeds = [0, 125, 250, 375, 500];
    function getClosest(arr, val) {
      return arr.reduce(function (prev, curr) {
        return (Math.abs(curr - val) < Math.abs(prev - val) ? curr : prev);
      });
    }
    document.querySelector("#SCROLL_SPEED").addEventListener("change", function () {
      let closest = getClosest(speeds, this.value);
      //this.value = document.querySelector("#rangevalue").value = closest;
      this.value = closest;
    });


  </script>
</body>

</html>
